{
  "cases": [
    {
      "name": "write-direct",
      "request": {
        "request_id": "cp3-direct-write-1",
        "session_id": "cp3-direct",
        "tool_name": "write",
        "args": {
          "path": "direct.txt",
          "content": "alpha\nline2\n"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed"
      }
    },
    {
      "name": "read-direct",
      "request": {
        "request_id": "cp3-direct-read-1",
        "session_id": "cp3-direct",
        "tool_name": "read",
        "args": {
          "path": "direct.txt"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "alpha"
      }
    },
    {
      "name": "edit-direct",
      "request": {
        "request_id": "cp3-direct-edit-1",
        "session_id": "cp3-direct",
        "tool_name": "edit",
        "args": {
          "path": "direct.txt",
          "oldText": "alpha",
          "newText": "beta"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed"
      }
    },
    {
      "name": "apply-patch-direct",
      "request": {
        "request_id": "cp3-direct-patch-1",
        "session_id": "cp3-direct",
        "tool_name": "apply_patch",
        "args": {
          "input": "*** Begin Patch\n*** Update File: direct.txt\n@@\n-beta\n+gamma\n*** End Patch"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "direct.txt"
      }
    },
    {
      "name": "read-direct-after-patch",
      "request": {
        "request_id": "cp3-direct-read-2",
        "session_id": "cp3-direct",
        "tool_name": "read",
        "args": {
          "path": "direct.txt"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "gamma"
      }
    },
    {
      "name": "write-sandbox",
      "request": {
        "request_id": "cp3-sandbox-write-1",
        "session_id": "cp3-sandbox",
        "tool_name": "write",
        "args": {
          "path": "sandbox.txt",
          "content": "sandbox-data"
        },
        "sandboxed": true
      },
      "expect": {
        "ok": true,
        "status": "completed"
      }
    },
    {
      "name": "read-sandbox",
      "request": {
        "request_id": "cp3-sandbox-read-1",
        "session_id": "cp3-sandbox",
        "tool_name": "read",
        "args": {
          "path": "sandbox.txt"
        },
        "sandboxed": true
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "sandbox-data"
      }
    },
    {
      "name": "sandbox-path-escape-denied",
      "request": {
        "request_id": "cp3-sandbox-escape-1",
        "session_id": "cp3-sandbox",
        "tool_name": "read",
        "args": {
          "path": "../escape.txt"
        },
        "sandboxed": true
      },
      "expect": {
        "ok": false,
        "errorCode": "path_outside_root"
      }
    },
    {
      "name": "exec-direct",
      "request": {
        "request_id": "cp3-exec-direct-1",
        "session_id": "cp3-exec",
        "tool_name": "exec",
        "args": {
          "command": "echo cp3-exec"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "contains": "cp3-exec"
      }
    },
    {
      "name": "gateway-status",
      "request": {
        "request_id": "cp3-gateway-status-1",
        "session_id": "cp3-gateway",
        "tool_name": "gateway",
        "args": {
          "action": "status"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "capabilities"
      }
    },
    {
      "name": "sessions-send",
      "request": {
        "request_id": "cp3-sessions-send-1",
        "session_id": "cp3-thread-1",
        "tool_name": "sessions",
        "args": {
          "action": "send",
          "message": "hello from sessions"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "cp3-thread-1"
      }
    },
    {
      "name": "sessions-history",
      "request": {
        "request_id": "cp3-sessions-history-1",
        "session_id": "cp3-thread-1",
        "tool_name": "sessions",
        "args": {
          "action": "history"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "hello from sessions"
      }
    },
    {
      "name": "message-default-send",
      "request": {
        "request_id": "cp3-message-send-1",
        "session_id": "cp3-thread-2",
        "tool_name": "message",
        "args": {
          "text": "hello from message tool"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "cp3-thread-2"
      }
    },
    {
      "name": "message-react",
      "request": {
        "request_id": "cp3-message-react-1",
        "session_id": "cp3-thread-2",
        "tool_name": "message",
        "args": {
          "action": "react",
          "emoji": "✅"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "reactionCount"
      }
    },
    {
      "name": "message-reactions",
      "request": {
        "request_id": "cp3-message-reactions-1",
        "session_id": "cp3-thread-2",
        "tool_name": "message",
        "args": {
          "action": "reactions"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "✅"
      }
    },
    {
      "name": "message-edit",
      "request": {
        "request_id": "cp3-message-edit-1",
        "session_id": "cp3-thread-2",
        "tool_name": "message",
        "args": {
          "action": "edit",
          "message": "hello from message tool edited"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "editedAt"
      }
    },
    {
      "name": "message-read",
      "request": {
        "request_id": "cp3-message-read-1",
        "session_id": "cp3-thread-2",
        "tool_name": "message",
        "args": {
          "action": "read",
          "limit": 5
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "hello from message tool edited"
      }
    },
    {
      "name": "message-delete",
      "request": {
        "request_id": "cp3-message-delete-1",
        "session_id": "cp3-thread-2",
        "tool_name": "message",
        "args": {
          "action": "delete"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "\"deleted\":true"
      }
    },
    {
      "name": "message-poll",
      "request": {
        "request_id": "cp3-message-poll-1",
        "session_id": "cp3-thread-2",
        "tool_name": "message",
        "args": {
          "action": "poll",
          "question": "Lunch?",
          "options": [
            "Pizza",
            "Sushi"
          ]
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "\"poll\""
      }
    },
    {
      "name": "browser-open",
      "request": {
        "request_id": "cp3-browser-open-1",
        "session_id": "cp3-browser",
        "tool_name": "browser",
        "args": {
          "action": "open",
          "url": "https://example.com"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "browser.proxy"
      }
    },
    {
      "name": "canvas-present",
      "request": {
        "request_id": "cp3-canvas-present-1",
        "session_id": "cp3-canvas",
        "tool_name": "canvas",
        "args": {
          "action": "present",
          "nodeId": "cp3-node-a",
          "view": "default"
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "canvas.present"
      }
    },
    {
      "name": "nodes-location-invoke",
      "request": {
        "request_id": "cp3-nodes-location-1",
        "session_id": "cp3-node",
        "tool_name": "nodes",
        "args": {
          "action": "invoke",
          "nodeId": "cp3-node-a",
          "command": "location.get",
          "params": {}
        },
        "sandboxed": false
      },
      "expect": {
        "ok": true,
        "status": "completed",
        "contains": "location.get"
      }
    }
  ]
}
